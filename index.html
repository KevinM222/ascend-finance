<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Ascend Crypto On-Ramp Service - Your Launchpad to the Future of Finance">
    <title>Ascend Finance</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="icon" href="assets/images/favicon_io/favicon.ico" type="image/x-icon">
</head>
<body>
    <!-- Hero section with background -->
    <section class="hero-section">
        <div class="logo-container">
            <!-- The Ascend tagline goes above the logo now -->
            <p class="tagline">Your Launchpad to the Future of Finance</p>
            <img src="assets/images/logo.webp" alt="Ascend Logo" class="main-logo">
        </div>

        <div class="wallet-container">
            <button id="connectWalletButton" onclick="connectWallet()">Connect Wallet</button>
            <button id="disconnectWalletButton" onclick="disconnectWallet()" style="display: none;">Disconnect Wallet</button>
            <button id="addToMetaMaskButton" onclick="addToMetaMask()" style="display: none;">Add ASC to MetaMask</button>
        </div>

        <!-- Token Information (Balance & Price) -->
        <div class="token-info-top">
            <p id="tokenBalance">Your ASC Balance: N/A</p>
            <p id="tokenPrice">ASC Price: Loading...</p>
        </div>
    </section>

    <!-- Navigation Bar -->
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="roadmap.html">Roadmap</a></li>
            <li><a href="whitepaper.html">Whitepaper</a></li>
            <li><a href="https://polygonscan.com/token/0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a" target="_blank">ASC Token</a></li>
        </ul>
    </nav>

    <!-- Empowering Quote and CTA Buttons -->
    <div class="bottom-content">
        <!-- SushiSwap Button -->
        <button class="cta-button-sushiswap" onclick="window.open('https://sushi.com/swap?inputCurrency=0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a&outputCurrency=POL', '_blank')">
            Swap ASC on SushiSwap
        </button>
        <!-- Empowering Quote -->
        <p class="empowering-quote">"Empower your financial future with Ascend."</p>
        <!-- Roadmap Button -->
        <button class="cta-button" onclick="window.location.href='roadmap.html'">Explore the Roadmap</button>
    </div>

    <!-- Include ethers.js UMD version -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script>
        let currentAddress = null;

        // Automatically update wallet state on account change
        window.ethereum.on('accountsChanged', function (accounts) {
            if (accounts.length === 0) {
                disconnectWallet();
            } else {
                connectWallet();
            }
        });

        // Connect to the wallet
        async function connectWallet() {
            const button = document.getElementById('connectWalletButton');
            const disconnectButton = document.getElementById('disconnectWalletButton');
            const addToMetaMaskButton = document.getElementById('addToMetaMaskButton');
            button.disabled = true;

            try {
                if (typeof window.ethereum === 'undefined') {
                    alert("MetaMask is not installed. Please install MetaMask to continue.");
                    return;
                }

                const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
                const userAddress = accounts[0];

                if (userAddress !== currentAddress) {
                    currentAddress = userAddress;
                    button.innerHTML = `Connected: ${userAddress.substring(0, 6)}...${userAddress.substring(userAddress.length - 4)}`;
                    button.style.backgroundColor = "#28a745";  // Green when connected
                    disconnectButton.style.display = 'inline-block';
                    addToMetaMaskButton.style.display = 'inline-block'; // Show button when wallet is connected
                    await getTokenBalance();
                    await getTokenPrice();
                }
            } catch (error) {
                alert("Failed to connect to MetaMask. Please try again.");
                button.disabled = false;
            }
        }

        // Disconnect the wallet
        function disconnectWallet() {
            const button = document.getElementById('connectWalletButton');
            const disconnectButton = document.getElementById('disconnectWalletButton');
            const addToMetaMaskButton = document.getElementById('addToMetaMaskButton');
            currentAddress = null;
            button.innerHTML = 'Connect Wallet';
            button.style.backgroundColor = "#007bff";
            disconnectButton.style.display = 'none';
            addToMetaMaskButton.style.display = 'none'; // Hide the Add ASC button when disconnected
            document.getElementById('tokenBalance').textContent = 'Your ASC Balance: N/A';
            document.getElementById('tokenPrice').textContent = 'ASC Price: Loading...';
        }

        // Fetch the user's token balance
        async function getTokenBalance() {
            if (!currentAddress) {
                alert("Please connect your wallet first.");
                return;
            }

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            const signer = provider.getSigner();
            const contractAddress = "0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a";
            const abi = ["function balanceOf(address owner) view returns (uint256)"];
            const contract = new ethers.Contract(contractAddress, abi, signer);

            try {
                const balance = await contract.balanceOf(currentAddress);
                const formattedBalance = ethers.utils.formatUnits(balance, 18);
                document.getElementById('tokenBalance').textContent = `Your ASC Balance: ${formattedBalance}`;
            } catch (error) {
                console.error("Error fetching balance:", error);
            }
        }

        // Fetch the current price of the ASC token
        async function getTokenPrice() {
            try {
                const response = await fetch('https://api.coingecko.com/api/v3/simple/token_price/polygon-pos?contract_addresses=0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a&vs_currencies=usd');
                const data = await response.json();
                const price = data['0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a'].usd;
                document.getElementById('tokenPrice').textContent = `ASC Price: $${price.toFixed(2)}`;
            } catch (error) {
                console.error("Error fetching price:", error);
                document.getElementById('tokenPrice').textContent = 'Unable to fetch price';
            }
        }

        // Add the ASC token to MetaMask
        function addToMetaMask() {
            const tokenAddress = '0x4456b0f017f6bf9b0aa7a0ac3d3f224902a1937a';
            const tokenSymbol = 'ASC';
            const tokenDecimals = 18;
            const tokenImage = 'assets/images/logo.webp'; // Optional image

            const params = [{
                type: 'ERC20',
                options: {
                    address: tokenAddress,
                    symbol: tokenSymbol,
                    decimals: tokenDecimals,
                    image: tokenImage
                }
            }];
            ethereum.request({
                method: 'wallet_watchAsset',
                params: params[0]
            }).then((result) => {
                if (result) {
                    alert("ASC token added to MetaMask!");
                } else {
                    alert("Failed to add ASC token to MetaMask.");
                }
            });
        }
    </script>
</body>
</html>
